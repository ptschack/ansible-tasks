- name: install
  become: true
  package:
    name: syncthing
    state: present

- name: copy config files
  copy:
    src: "{{ item }}"
    dest: ~/.config/syncthing
    force: no
  with_items:
    - "{{ inventory_hostname }}/cert.pem"
    - "{{ inventory_hostname }}/config.xml"
    - "{{ inventory_hostname }}/csrftokens.txt"
    - "{{ inventory_hostname }}/https-cert.pem"
    - "{{ inventory_hostname }}/https-key.pem"
    - "{{ inventory_hostname }}/key.pem"
  ignore_errors: yes

- name: configure & start service
  become: yes
  systemd:
    name: "syncthing@{{ ansible_user }}.service"
    daemon_reload: yes
    enabled: yes
    state: restarted